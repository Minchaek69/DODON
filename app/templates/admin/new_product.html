{% extends 'base.html' %} {% block title %}상품 업로드{% endblock %} {% block
content %}
<div class="max-w-2xl mx-auto py-10 px-4">
  <h1 class="text-3xl font-bold mb-6">상품 업로드</h1>

  <form
    action="{{ url_for('admin_bp.new_product') }}"
    method="POST"
    enctype="multipart/form-data"
    class="space-y-6 bg-white p-6 rounded shadow-md border"
  >
    <!-- 상품 기본 정보 -->
    <div>
      <label class="block mb-1 font-medium">상품명</label>
      <input
        type="text"
        name="name"
        required
        class="w-full border border-gray-300 px-3 py-2 rounded"
      />
    </div>

    <div>
      <label class="block mb-1 font-medium">상품번호</label>
      <input
        type="text"
        name="product_code"
        required
        class="w-full border border-gray-300 px-3 py-2 rounded"
      />
    </div>

    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block mb-1 font-medium">가격</label>
        <input
          type="number"
          name="price"
          step="0.01"
          required
          class="w-full border border-gray-300 px-3 py-2 rounded"
        />
      </div>
      <div>
        <label class="block mb-1 font-medium">카테고리</label>
        <select
          name="category"
          required
          class="w-full border border-gray-300 px-3 py-2 rounded"
        >
          <option value="1">상의</option>
          <option value="2">하의</option>
          <option value="3">원피스</option>
          <option value="4">아우터</option>
          <option value="5">세트</option>
          <option value="6">기타</option>
        </select>
      </div>
    </div>

    <div>
      <label class="block mb-1 font-medium">소재</label>
      <input
        type="text"
        name="material"
        placeholder="면 100%"
        required
        class="w-full border border-gray-300 px-3 py-2 rounded"
      />
    </div>

    <div>
      <label class="block mb-1 font-medium">설명</label>
      <textarea
        name="description"
        rows="4"
        class="w-full border border-gray-300 px-3 py-2 rounded"
      ></textarea>
    </div>
    <!-- Variants 관리 영역 -->
    <div>
      <h2 class="text-xl font-semibold mb-2">Variants (색상·사이즈·재고)</h2>
      <div id="variants-container" class="space-y-4">
        <!-- 模板行：第一次显示一行 -->
        <div class="variant-row grid grid-cols-3 gap-2 items-end">
          <div>
            <label class="block mb-1 text-sm">색상</label>
            <input
              type="text"
              name="variant_color[]"
              required
              placeholder="예: 블랙"
              class="w-full border border-gray-300 px-2 py-1 rounded"
            />
          </div>
          <div>
            <label class="block mb-1 text-sm">사이즈</label>
            <input
              type="text"
              name="variant_size[]"
              required
              placeholder="예: FREE"
              class="w-full border border-gray-300 px-2 py-1 rounded"
            />
          </div>
          <div>
            <label class="block mb-1 text-sm">재고</label>
            <input
              type="number"
              name="variant_stock[]"
              required
              min="0"
              value="0"
              class="w-full border border-gray-300 px-2 py-1 rounded"
            />
          </div>
          <button
            type="button"
            class="remove-variant-btn self-start text-red-500 hover:text-red-700"
            title="삭제"
          >
            &times;
          </button>
        </div>
      </div>
      <button
        type="button"
        id="add-variant-btn"
        class="mt-2 text-sm text-blue-600 hover:underline"
      >
        + Variant 추가
      </button>
    </div>

    <!-- 이미지 업로드 -->
    <div>
      <label class="block mb-1 font-medium">대표 이미지 (1장)</label>
      <input
        type="file"
        name="main_image"
        accept="image/*"
        required
        class="block"
      />
    </div>
    <div>
      <label class="block mb-1 font-medium">상세 이미지 (여러장)</label>
      <input
        type="file"
        name="detail_images"
        accept="image/*"
        multiple
        class="block"
      />
    </div>
    <div>
      <label class="block mb-1 font-medium">사이즈 이미지</label>
      <input type="file" name="size_image" accept="image/*" class="block" />
    </div>

    <div>
      <button
        type="submit"
        class="bg-black text-white px-4 py-2 rounded hover:bg-gray-800"
      >
        업로드
      </button>
    </div>
  </form>
</div>

<script>
  // 在页面加载后注册按钮事件
  document.addEventListener("DOMContentLoaded", () => {
    const container = document.getElementById("variants-container");
    const addBtn = document.getElementById("add-variant-btn");

    // 添加新行
    addBtn.addEventListener("click", () => {
      const template = container.querySelector(".variant-row");
      const clone = template.cloneNode(true);
      // 清空输入
      clone.querySelectorAll("input").forEach((i) => (i.value = ""));
      container.appendChild(clone);
      attachRemoveHandler(clone);
    });

    // 为已有行注册删除
    container.querySelectorAll(".variant-row").forEach((row) => {
      attachRemoveHandler(row);
    });

    function attachRemoveHandler(row) {
      const btn = row.querySelector(".remove-variant-btn");
      btn.addEventListener("click", () => {
        // 保持至少一行
        if (container.querySelectorAll(".variant-row").length > 1) {
          row.remove();
        }
      });
    }
  });
</script>
{% endblock %}
