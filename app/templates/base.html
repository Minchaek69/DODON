<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}DODON | 행운을 가져다주는 옷{% endblock %}</title>

    <!-- SEO Meta -->
    <meta
      name="description"
      content="DODON은 20~35세 여성을 위한 유니크한 감성의 브랜드입니다. 롱스커트, 미니원피스, 오버핏 상의 등, 나만의 행운을 이끄는 개성 있는 옷들을 만나보세요."
    />
    <meta
      name="keywords"
      content="DODON, 여성의류, 유니크, 패션, 미니원피스, 롱스커트, 니트"
    />
    <meta name="author" content="DODON" />

    <!-- Favicon -->
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>

  <body>
    <header class="header-bar">
      <div class="header-container">
        <!-- Left: Logo -->
        <div class="header-left">
          <a href="/">
            <img src="/static/images/dodon_logo_wide.png" alt="DODON Logo" />
          </a>
        </div>

        <!-- Center: Navigation Menu -->
        <nav class="header-center">
          <ul>
            <li><a href="{{ url_for('main.index') }}">홈</a></li>
            <li><a href="{{ url_for('products_bp.index') }}">전체 상품</a></li>
            <li><a href="#">상의</a></li>
            <li><a href="#">하의</a></li>
            <li><a href="#">원피스</a></li>
            <li><a href="#">도움</a></li>
            <li><a href="#">About us</a></li>
          </ul>
        </nav>

        <!-- Right: Icons -->
        <div class="header-right">
          <form action="/search" method="GET" class="search-inline">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" name="q" placeholder="검색" class="search-box" />
          </form>
          <a
            href="{{ url_for('cart.view_cart') }}"
            title="장바구니"
            class="relative"
          >
            <i class="fa-solid fa-bag-shopping"></i>
            {% if cart_count > 0 %}
            <span
              class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full text-xs w-3.5 h-3.5 flex items-center justify-center"
            >
              {{ cart_count }}
            </span>
            {% endif %}
          </a>

          {% if session.get('user_email') %} {% if session.get('is_admin') %}
          <a
            href="{{ url_for('admin_bp.admin_products') }}"
            title="상품 업로드"
          >
            <i class="fa-solid fa-upload"></i>
          </a>
          {% endif %}

          <!-- 로그인 상태: 사용자 정보로 이동 -->
          <a href="{{ url_for('main.profile') }}" title="마이페이지">
            <i class="fa-solid fa-user"></i>
          </a>
          <a href="{{ url_for('auth_bp.logout') }}" title="로그아웃">
            <i class="fa-solid fa-right-from-bracket"></i>
          </a>
          {% else %}
          <!-- 비로그인 상태: 로그인 모달 열기 -->
          <a id="login-trigger" title="로그인">
            <i class="fa-solid fa-user"></i>
          </a>
          {% endif %}
        </div>
      </div>
    </header>

    <!-- Main Page Content -->
    <main>{% block content %} {% endblock %}</main>

    <!-- Flash 信息栏 -->
    <div
      id="flash-container"
      class="fixed top-16 left-1/2 transform -translate-x-1/2 z-50 w-full max-w-xl px-4 pointer-events-none"
    >
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, msg in messages %}
      <div
        class="pointer-events-auto mb-2 px-6 py-3 rounded-lg shadow-lg {% if category=='success' %}bg-green-100 text-green-800 {% elif category=='error' %}bg-red-100 text-red-800 {% else %}bg-gray-100 text-gray-800 {% endif %}"
      >
        {{ msg }}
      </div>
      {% endfor %} {% endif %} {% endwith %}
    </div>

    <!-- FOOTER -->
    <footer class="bg-white border-t py-6">
      <div class="container mx-auto text-center text-sm text-gray-600">
        <div class="space-x-4 mb-2">
          <a href="#" class="hover:text-black">Contact</a>
          <a href="#" class="hover:text-black">Instagram</a>
          <a href="#" class="hover:text-black">Pinterest</a>
          <a href="#" class="hover:text-black">Terms</a>
        </div>
        <p>&copy; {{ current_year }} DODON. All rights reserved.</p>
      </div>
    </footer>

    <!-- LOGIN & SIGNUP MODALS -->
    {% include 'login_modal.html' %} {% include 'signup_modal.html' %}

    <!-- COMMON SCRIPTS -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/login_modal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/signup_modal.js') }}"></script>

    <!-- Flash auto-hide logic -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const flashes = document.querySelectorAll(".flash-item");
        flashes.forEach((el) => {
          // wait 4s then fade out
          setTimeout(() => {
            el.style.transition = "opacity 0.5s";
            el.style.opacity = 0;
            el.addEventListener("transitionend", () => el.remove());
          }, 4000);
        });
      });
    </script>

    <!-- PAGE-SPECIFIC SCRIPTS -->
    {% block scripts %}{% endblock %}
  </body>
</html>
